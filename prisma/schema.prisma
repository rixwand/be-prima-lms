generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserStatus {
  NOT_VERIFIED
  ACTIVE
  DISABLED
}

model User {
  id            Int @id @default(autoincrement())
  fullName      String @map("full_name")
  email         String @unique
  username      String
  passwordHash  String @map("password_hash")
  status        UserStatus @default(NOT_VERIFIED)

  roles         UserRole[]

  @@map("users")
}

model Role {
  id            Int @id @default(autoincrement())
  name          String @unique
  
  user          UserRole[]
  perms    RolePermission[]

  @@map("roles")
}

model Permission {
  id            Int @id @default(autoincrement())
  action        String
  resource      String
  scope         String

  roles         RolePermission[]

  @@unique([scope, action, resource])      
  @@map("permissions")
}

model UserRole {
  userId        Int
  roleId        Int

  user          User @relation(fields: [userId], references: [id])
  role          Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
  @@map("user_roles")
}

model RolePermission {
  roleId        Int
  permissionId  Int

  role          Role       @relation(fields: [roleId], references: [id])
  permission    Permission @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
  @@map("role_permissions")
}